--Exercice 3

--Q1)
-- Combien de colone dans import :
SELECT COUNT(*) AS "Nombre de colone de la table import" FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'import';

--Q2)
-- Combien de ligne dans import :
SELECT COUNT(*) AS "Nombre de ligne de la table import" FROM import;

--Q3)
-- Combien de codes NOC dans noc :
SELECT COUNT(*) AS "Le nombre de NOC dans la table regions"
FROM region
WHERE noc IS NOT null;

--Q4)
-- Combien d'athletes differents sont référencés dans import
SELECT COUNT(DISTINCT id) AS "Nombre total d'atlètes dans la table import"
FROM import;

--Q5)
-- Combien y a-t-il de médaille d'or dans ce fichier
SELECT COUNT(medal) AS "Nombre de medaille d'or"
FROM import
WHERE medal = 'Gold';

--Q6)
-- Retrouver Carl Lewis et combien de lignes se réfèrent à lui
-- Nous sommes partis du principe que Carl Lewis est l'athète américain partiquant l'athlétisme
-- Donc son nom de naissance est 'Frederickl Carlton Lewis'.
SELECT COUNT(*) AS "Nombre de ligne faisant référence à Carl LEWIS"
FROM import
WHERE name LIKE 'Frederick Carlton%';



--Exercice 5

--Q1)
-- Liste des pays classés par participation aux épreuves (2 cols)
SELECT team.team, COUNT(performance.events_eno) AS "Nombre de participation"
FROM team INNER JOIN performance 
    ON (team.noc = performance.team_noc)
GROUP BY team.noc
ORDER BY "Nombre de participation" DESC;

--Q2) 
-- Liste des pays classés par nombre de médailles d’or (2 cols) 
SELECT team.team, COUNT(*) AS "Nombre de medailles d'or" 
FROM team INNER JOIN performance ON (team.noc = performance.team_noc) 
WHERE medal = 'Gold'
GROUP BY team.noc
ORDER BY "Nombre de medailles d'or" DESC;

--Q3)
-- Liste des pays classés par nombre médailles totales
SELECT team.team, COUNT(*) AS "Nombre de medailles"
FROM team INNER JOIN performance ON (team.noc = performance.team_noc)
WHERE medal IS NOT NULL
GROUP BY team.team
ORDER BY "Nombre de medailles" DESC;

--Q4)
-- Liste des sportifs ayant le plus de médailles d’or, avec le nombre (3 cols)
SELECT a.id, a.name, COUNT(*) AS "Nombre de medaille d'or par athlete"
FROM athlete AS A INNER JOIN performance AS p ON(a.id = p.athlete_id)
WHERE medal = 'Gold'
GROUP BY a.id, a.name
ORDER BY "Nombre de medaille d'or par athlete" DESC;

--Q5)
-- Nombre de médailles cumulées par pays pour les Jeux d’Albertville, par ordre décroissant
SELECT team.team, COUNT(*) AS "Nombre de medaille par pays"
FROM performance
INNER JOIN team ON performance.team_noc = team.noc
INNER JOIN games ON performance.games_gno = games.gno
WHERE games.city = 'Albertville'
GROUP BY team.team
ORDER BY "Nombre de medaille par pays" DESC;

--Q6)
--Combien de sportifs ont fait les jeux olympiques sous 2 drapeaux différents, le dernier étant la France ?
SELECT COUNT(DISTINCT p1.athlete_id) AS "Nombre d'athete avec deux dont france en dernier"
FROM performance as p1
INNER JOIN games as g1 on p1.games_gno = g1.gno
INNER JOIN team as t1 on p1.team_noc = t1.noc
WHERE t1.noc != 'FRA'
AND EXISTS (
    SELECT 1
    FROM performance as p2
    INNER JOIN games as g2 on p2.games_gno = g2.gno
    INNER JOIN team as t2 on p2.team_noc = t2.noc
    WHERE p1.athlete_id = p2.athlete_id
    AND g1.year < g2.year
    AND t2.noc = 'FRA'
); 

--Q7)
-- Combien de sportifs ont fait les jeux olympiques sous 2 drapeaux différents, le premier étant la France ? (1 valeur)
SELECT COUNT(DISTINCT p1.athlete_id) AS nombre_athletes
FROM performance as p1
INNER JOIN games as g1 on p1.games_gno = g1.gno
INNER JOIN team as t1 on p1.team_noc = t1.noc
WHERE t1.noc = 'FRA'
AND EXISTS (
    SELECT 1
    FROM performance as p2
    INNER JOIN games as g2 on p2.games_gno = g2.gno
    INNER JOIN team as t2 on p2.team_noc = t2.noc
    WHERE p1.athlete_id = p2.athlete_id 
    AND g1.year < g2.year
    AND t2.noc != 'FRA'
);

--Q8)
--Distribution des âges des médaillés d’or (2 cols)
SELECT age, COUNT(*) AS "Nombre de medaille d'or"
FROM performance AS p 
WHERE medal = 'Gold' AND age IS NOT NULL
GROUP BY age
ORDER BY age ASC;

--Q9)
--Distribution des disciplines donnant des médailles aux plus de 50 ans par ordre décroissant (2 cols)
SELECT e.event, COUNT(*) AS "Nombre de medaille"
FROM events AS e INNER JOIN performance AS p
    ON e.eno = p.events_eno
WHERE p.age > 50
GROUP BY e.event
ORDER BY COUNT(*) desc; 

--Q10)
--Nombre d’épreuves par type de jeux (hivers,été), par année croissante (3 cols)
SELECT g.year, g.season, COUNT(DISTINCT p.events_eno) AS "Nombre d'epreuves"
FROM performance AS p INNER JOIN games AS g ON p.games_gno = g.gno
GROUP BY year, season
ORDER BY g.year ASC;


--Q11
--Nombre de médailles féminines aux jeux d’été par année croissante (2 cols)
SELECT games.year, COUNT(*) as nb_medals
FROM performance
JOIN games ON performance.games_gno = games.gno
WHERE performance.medal IN ('Gold', 'Silver', 'Bronze')
AND games.season = 'Summer'
AND athlete_id IN (
    SELECT id FROM athlete WHERE sex = 'F'
)
GROUP BY games.year
ORDER BY games.year ASC;


--Exercice 6
-- Nous avons choisi de traiter les athlètes francais pratiquant l'athlétisme pour cette exercice

-- Nous allons d'abord calculer le nombre de participation total en athlétisme depuis 1920
SELECT COUNT(*) AS "Nombre de participation total"
FROM events AS e INNER JOIN performance AS p
    ON e.eno = p.events_eno
WHERE sport = 'Athletics'
AND p.team_noc = 'FRA';

-- Nombre de participation par epreuve depuis 1920
SELECT e.event, COUNT(*) AS "Nombre de participant par epreuve"
FROM events AS e INNER JOIN performance AS p ON e.eno = p.events_eno
WHERE e.sport = 'Athletics'
AND p.team_noc = 'FRA'
GROUP BY e.event
ORDER BY "Nombre de participant par epreuve" DESC;

--Age moyen et la taille moyenne des athlete francais lors des dernier jeux (JO de rio)
-- Nous voulions mettre le resultat du poids à un chiffre après la virgule mais la fonction nous renvoyer une erreur si nous mettions un choffre après la virgule 
SELECT ROUND(AVG(p.weight)) AS "Moyenne du poids des athletes francais", ROUND(AVG(p.height), 1) AS "Moyenne de la taille des athletes francais"
FROM performance AS p INNER JOIN events AS e ON p.events_eno = e.eno
    INNER JOIN games AS g ON g.gno = p.games_gno
WHERE e.sport = 'Athletics' 
AND p.team_noc = 'FRA'
AND g.year = 2016;

--Top 10 des athletes francais avec le plus de medaille d'or
SELECT a.name, COUNT(*) AS "Nombre de médaille d'or"
FROM performance AS p INNER JOIN athlete AS a ON p.athlete_id = a.id
    INNER JOIN events AS e ON p.events_eno = e.eno 
WHERE e.sport = 'Athletics' 
AND p.team_noc = 'FRA'
AND medal = 'Gold'
GROUP BY a.name
ORDER BY "Nombre de médaille d'or" DESC;